!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).WaveformData=e()}}((function(){return function e(t,n,a){function r(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[s]={exports:{}};t[s][0].call(f.exports,(function(e){return r(t[s][1][e]||e)}),f,f.exports,e,t,n,a)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)r(a[s]);return r}({1:[function(e,t,n){"use strict";function a(e){this._data=new DataView(e),this._offset=2===this.version?24:20}a.isCompatible=function(e){const t=e&&"object"==typeof e&&"byteLength"in e;if(t){const t=new DataView(e).getInt32(0,!0);if(1!==t&&2!==t)throw new TypeError("This waveform data version not supported.")}return t},a.prototype={get version(){return this._data.getInt32(0,!0)},get bits(){return Boolean(this._data.getUint32(4,!0))?8:16},get channels(){return 2===this.version?this._data.getInt32(20,!0):1},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},get length(){return this._data.getUint32(16,!0)},at:function(e){return this._data.getInt8(this._offset+e)}},t.exports=a},{}],2:[function(e,t,n){"use strict";function a(e){this._data=e}a.isCompatible=function(e){return e&&"object"==typeof e&&"sample_rate"in e&&"samples_per_pixel"in e&&"bits"in e&&"length"in e&&"data"in e},a.prototype={get version(){return this._data.version||1},get bits(){return this._data.bits},get channels(){return this._data.channels||1},get sample_rate(){return this._data.sample_rate},get scale(){return this._data.samples_per_pixel},get length(){return this._data.length},at:function(e){const t=this._data.data;if(e>=0&&e<t.length)return t[e];throw new RangeError("Invalid index: "+e)}},t.exports=a},{}],3:[function(e,t,n){"use strict";var a=e("../core"),r=e("inline-worker");t.exports=function(e,t){return function(n){var i=new r((function(){this.addEventListener("message",(function(e){var t=e.data.scale,n=e.data.amplitude_scale,a=e.data.split_channels,r=e.data.audio_buffer,i=r.channels,s=a?i.length:1,o=1===s?1:2,l=1===o?20:24,u=function(e,t){var n=Math.floor(e/t);return e-n*t>0&&n++,n}(r.length,t),f=new DataView(new ArrayBuffer(l+2*u*s)),h=new Array(s),c=new Array(s);for(let e=0;e<s;e++)h[e]=1/0,c[e]=-1/0;var p,d,_=0,m=r.length,w=l;for(f.setInt32(0,o,!0),f.setUint32(4,1,!0),f.setInt32(8,r.sampleRate,!0),f.setInt32(12,t,!0),f.setInt32(16,u,!0),2===o&&f.setInt32(20,s,!0),d=0;d<m;d++){var g=0;if(1===s){for(p=0;p<i.length;++p)g+=i[p][d];(g=Math.floor(127*g*n/i.length))<h[0]&&(h[0]=g,h[0]<-128&&(h[0]=-128)),g>c[0]&&(c[0]=g,c[0]>127&&(c[0]=127))}else for(p=0;p<s;++p)(g=Math.floor(127*i[p][d]*n))<h[p]&&(h[p]=g,h[p]<-128&&(h[p]=-128)),g>c[p]&&(c[p]=g,c[p]>127&&(c[p]=127));if(++_===t){for(p=0;p<s;p++)f.setInt8(w++,h[p]),f.setInt8(w++,c[p]),h[p]=1/0,c[p]=-1/0;_=0}}if(_>0)for(p=0;p<s;p++)f.setInt8(w++,h[p]),f.setInt8(w++,c[p]);this.postMessage(f)}))}));i.addEventListener("message",(function(e){var r=e.data;t(null,new a(r.buffer),n)}));for(var s={length:n.length,sampleRate:n.sampleRate,channels:[]},o=0;o<n.numberOfChannels;++o)s.channels[o]=n.getChannelData(o);i.postMessage({scale:e.scale,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,audio_buffer:s})}}},{"../core":7,"inline-worker":8}],4:[function(e,t,n){"use strict";var a={scale:512,amplitude_scale:1,split_channels:!1};t.exports=function(e){if(Object.prototype.hasOwnProperty.call(e,"scale_adjuster"))throw new Error("Please rename the 'scale_adjuster' option to 'amplitude_scale'");return{scale:e.scale||a.scale,amplitude_scale:e.amplitude_scale||a.amplitude_scale,split_channels:e.split_channels||a.split_channels}}},{}],5:[function(e,t,n){"use strict";var a=e("./audiodecoder"),r=e("./options");t.exports=function(e,t){var n=r(e);if(e.audio_context&&e.array_buffer)return function(e,t,n,r){e.decodeAudioData(t,a(n,r),(function(e){e||(e=new DOMException("EncodingError")),r(e)}))}(e.audio_context,e.array_buffer,n,t);if(e.audio_buffer)return function(e,t,n){return a(t,n)(e)}(e.audio_buffer,n,t);throw new TypeError("Please pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")}},{"./audiodecoder":3,"./options":4}],6:[function(e,t,n){"use strict";function a(e,t){this._waveformData=e,this._channelIndex=t}a.prototype.min_sample=function(e){const t=2*(e*this._waveformData.channels+this._channelIndex);return this._waveformData._adapter.at(t)},a.prototype.max_sample=function(e){const t=2*(e*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._adapter.at(t)},a.prototype.min_array=function(){return this._waveformData._offsetValues(0,this._waveformData.length,2*this._channelIndex)},a.prototype.max_array=function(){return this._waveformData._offsetValues(0,this._waveformData.length,2*this._channelIndex+1)},t.exports=a},{}],7:[function(e,t,n){"use strict";var a=e("./channel"),r=e("./adapters/object"),i=[e("./adapters/arraybuffer"),r];function s(e){var t=this._getAdapter(e);this._adapter=new t(e),this._channels=[];for(let e=0;e<this.channels;e++)this._channels[e]=new a(this,e)}s.create=function(e){return new s(e)},s.prototype={_getAdapter:function(e){var t=null;if(i.some((function(n){if(n.isCompatible(e))return t=n,!0})),null===t)throw new TypeError("Could not detect a WaveformData adapter from the input.");return t},resample:function(e){"number"==typeof e&&(e={width:e}),e.input_index="number"==typeof e.input_index?e.input_index:null,e.output_index="number"==typeof e.output_index?e.output_index:null,e.scale="number"==typeof e.scale?e.scale:null,e.width="number"==typeof e.width?e.width:null;var t=Boolean(e.input_index)||Boolean(e.output_index);if(null!=e.input_index&&e.input_index<0)throw new RangeError("options.input_index should be a positive integer value. ["+e.input_index+"]");if(null!=e.output_index&&e.output_index<0)throw new RangeError("options.output_index should be a positive integer value. ["+e.output_index+"]");if(null!=e.width&&e.width<=0)throw new RangeError("options.width should be a strictly positive integer value. ["+e.width+"]");if(null!=e.scale&&e.scale<=0)throw new RangeError("options.scale should be a strictly positive integer value. ["+e.scale+"]");if(!e.scale&&!e.width)throw new RangeError("You should provide either a resampling scale or a width in pixel the data should fit in.");var n=["width","scale","output_index","input_index"].reduce((function(t,n){return t+(null===e[n]?0:1)}),0);if(t&&4!==n)throw new Error("Some partial resampling options are missing. You provided "+n+" of them over 4.");var a=[],r=e.scale||Math.floor(this.duration*this.sample_rate/e.width),i=this.scale,o=2*this.channels,l=this.length,u=e.input_index||0,f=e.output_index||0,h=this.channels,c=new Array(h),p=new Array(h);for(let e=0;e<h;++e)l>0?(c[e]=this.channel(e).min_sample(u),p[e]=this.channel(e).max_sample(u)):(c[e]=0,p[e]=0);var d,_,m,w;if(r<i)throw new Error("Zoom level "+r+" too low, minimum: "+i);function g(e){return Math.floor(e*r)}function v(e,t){a.push(e,t)}for(;u<l;){for(;Math.floor(g(f)/i)<=u;){if(f>0)for(let e=0;e<h;++e)v(c[e],p[e]);if(w=u,(d=g(++f))!==g(f-1))for(let e=0;e<h;++e)c[e]=127,p[e]=-128}for(d=g(f),(_=Math.floor(d/i))>l&&(_=l);u<_;){for(let e=0;e<h;++e)(m=this.channel(e).min_sample(u))<c[e]&&(c[e]=m),(m=this.channel(e).max_sample(u))>p[e]&&(p[e]=m);u++}if(t&&a.length/o>=e.width)break}if(t){if(a.length/o>e.width&&u!==w)for(let e=0;e<h;++e)v(c[e],p[e])}else if(u!==w)for(let e=0;e<h;++e)v(c[e],p[e]);return new s({version:this._adapter.version,bits:this.bits,samples_per_pixel:r,length:a.length/o,data:a,sample_rate:this.sample_rate,channels:h})},_offsetValues:function(e,t,n){var a=this._adapter,r=[],i=this.channels;n+=e*i*2;for(var s=0;s<t;s++)r.push(a.at(s*i*2+n));return r},get length(){return this._adapter.length},get bits(){return this._adapter.bits},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return this._adapter.channels},channel:function(e){if(e>=0&&e<this._channels.length)return this._channels[e];throw new RangeError("Invalid channel: "+e)},get sample_rate(){return this._adapter.sample_rate},get scale(){return this._adapter.scale},at_time:function(e){return Math.floor(e*this.sample_rate/this.scale)},time:function(e){return e*this.scale/this.sample_rate}},t.exports=s},{"./adapters/arraybuffer":1,"./adapters/object":2,"./channel":6}],8:[function(e,t,n){(function(e){var n=!!(e===e.window&&e.URL&&e.Blob&&e.Worker);function a(t,a){var r,i=this;if(a=a||{},n)return r=t.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new e.Worker(e.URL.createObjectURL(new e.Blob([r],{type:"text/javascript"})));this.self=a,this.self.postMessage=function(e){setTimeout((function(){i.onmessage({data:e})}),0)},setTimeout(t.bind(a,a),0)}a.prototype.postMessage=function(e){var t=this;setTimeout((function(){t.self.onmessage({data:e})}),0)},t.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],"/waveform-data.js":[function(e,t,n){"use strict";var a=e("./lib/core");a.createFromAudio=e("./lib/builders/webaudio"),t.exports=a},{"./lib/builders/webaudio":5,"./lib/core":7}]},{},[])("/waveform-data.js")}));
